# yaml-language-server: $schema=https://raw.githubusercontent.com/LucasPickering/slumber/refs/tags/v4.0.1/schemas/collection.json

name: Server

.base_profile_data:
  city_id: "{{ response('c_get_all', trigger='always') | jsonpath('$[*]._id', mode='array') | select() }}"
  building_type: "{{ select(['house', 'apartments', 'wind_turbine'], message='Type') }}"

profiles:
  local:
    data:
      $ref: "#/.base_profile_data"
      host: http://localhost:3000

requests:
  accounts:
    name: Accounts
    requests:
      a_login:
        name: Login
        method: POST
        url: "{{ host }}/login"
        body:
          type: json
          data:
            name: "{{ prompt(message='Name') }}"
            pass: "{{ prompt(message='Pass') }}"
      a_post_one:
        name: Post One
        method: POST
        url: "{{ host }}/accounts"
        body:
          type: json
          data:
            name: "{{ prompt(message='Name') }}"
            pass: "{{ prompt(message='Pass') }}"
      
  cities:
    name: Cities
    requests:
      c_get_all:
        name: Get All
        method: GET
        url: "{{ host }}/cities"
      c_post_one:
        name: Post One
        method: POST
        url: "{{ host }}/cities"
        body:
          type: json
          data:
            name: "{{ prompt(message='Name') }}"
      c_update_one:
        name: Patch One
        method: PATCH
        url: "{{ host }}/cities/{{ city_id }}"
        body:
          type: json
          data:
            name: "{{ prompt(message='Name') }}"
      c_delete_by_id:
        name: Delete by ID
        method: DELETE
        url: "{{ host }}/cities/{{ city_id }}"
  buildings:
    name: Buildings
    requests:
      b_get_all_city:
        name: Get All from City
        method: GET
        url: "{{ host }}/buildings/{{ city_id }}"
      b_post_one:
        name: Post One
        method: POST
        url: "{{ host }}/buildings"
        body:
          type: json
          data:
            city: "{{ city_id }}"
            type: "{{ building_type }}"
            position:
              x: "{{ prompt(message='X Coordinate') | integer() }}"
              y: "{{ prompt(message='Y Coordinate') | integer() }}"
            orientation: "{{ select(['n', 's', 'e', 'w'], message='Orientation') }}"
